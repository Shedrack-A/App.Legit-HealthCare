{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div>
            <h2>Manage Users</h2>
            <p class="text-secondary">Edit user details, change roles, or reset passwords.</p>
        </div>
        <!-- Optional: Add a "New User" button here if needed in the future -->
    </div>

    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Phone Number</th>
                    <th>Roles</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users.items %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.first_name }} {{ user.last_name }}</td>
                    <td>{{ user.phone_number }}</td>
                    <td>
                        {% for role in user.roles %}
                            <span class="badge badge-secondary">{{ role.name }}</span>
                        {% else %}
                            <span class="badge">None</span>
                        {% endfor %}
                    </td>
                    <td>
                        <a href="{{ url_for('admin.edit_user', user_id=user.id) }}" class="btn btn-sm btn-secondary"><i class="fas fa-edit"></i> Edit</a>
                        <a href="{{ url_for('admin.change_user_password', user_id=user.id) }}" class="btn btn-sm btn-secondary"><i class="fas fa-key"></i> Change Password</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if users.pages > 1 %}
    <div class="pagination">
        <a href="{{ url_for('admin.list_users', page=1) }}" class="{{ 'disabled' if not users.has_prev else '' }}">&laquo;&laquo;</a>
        <a href="{{ url_for('admin.list_users', page=users.prev_num) }}" class="{{ 'disabled' if not users.has_prev else '' }}">&laquo;</a>

        {% for page_num in users.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
            {% if page_num %}
                <a href="{{ url_for('admin.list_users', page=page_num) }}" class="{{ 'current-page' if page_num == users.page else '' }}">{{ page_num }}</a>
            {% else %}
                <span>...</span>
            {% endif %}
        {% endfor %}

        <a href="{{ url_for('admin.list_users', page=users.next_num) }}" class="{{ 'disabled' if not users.has_next else '' }}">&raquo;</a>
        <a href="{{ url_for('admin.list_users', page=users.pages) }}" class="{{ 'disabled' if not users.has_next else '' }}">&raquo;&raquo;</a>
    </div>
    {% endif %}
</div>
{% endblock %}
