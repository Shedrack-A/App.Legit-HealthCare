{% extends "base.html" %}

{% block navigation %}
<!-- No main navigation for patient portal -->
{% endblock %}

{% block content %}
<div class="patient-portal-dashboard">
    {% if latest_patient_record %}
    <div class="patient-header">
        <h2>Welcome, {{ latest_patient_record.first_name }} {{ latest_patient_record.last_name }}</h2>
        <p>This is your personal health portal. You can view and download your annual screening reports here.</p>
        <div>
            <a href="{{ url_for('portal.settings') }}">Settings</a> |
            <a href="{{ url_for('portal.logout') }}">Logout</a>
        </div>
    </div>

    <div class="page-section">
        <h3>Your Details</h3>
        <ul>
            <li><strong>Staff ID:</strong> {{ latest_patient_record.staff_id }}</li>
            <li><strong>Department:</strong> {{ latest_patient_record.department }}</li>
            <li><strong>Date of Birth:</strong> {{ latest_patient_record.date_of_birth.strftime('%Y-%m-%d') }}</li>
        </ul>
    </div>

    <div class="page-section">
        <h3>Download Your Report</h3>
        <p>Select a screening year to download your comprehensive health report as a PDF.</p>
        <div class="report-actions">
            <form action="{{ url_for('portal.download_report') }}" method="POST" class="report-form d-inline">
                <select name="patient_id" class="form-control select2-enable">
                    {% for record in patient_records %}
                    <option value="{{ record.id }}">{{ record.screening_year }} Report</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-primary mt-2">Download Report</button>
            </form>
            <form action="{{ url_for('portal.email_report') }}" method="POST" class="report-form d-inline">
                 <select name="patient_id" class="form-control select2-enable">
                    {% for record in patient_records %}
                    <option value="{{ record.id }}">{{ record.screening_year }} Report</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-secondary mt-2">Email Report</button>
            </form>
        </div>
    </div>
    {% else %}
    <div class="patient-header">
        <h2>Welcome</h2>
        <p>We couldn't find any patient records associated with your account's Staff ID. Please contact an administrator.</p>
        <a href="{{ url_for('portal.logout') }}">Logout</a>
    </div>
    {% endif %}
</div>
{% endblock %}
